services:
    _defaults:
        autowire: true
        autoconfigure: false
        public: false

    # Auto-configure all bundle classes
    Acme\Bundle\CustomerGroupInventoryBundle\:
        resource: '../../*'
        exclude:
            - '../../{Entity,Resources,Migrations,Tests}'
            - '../../DependencyInjection/Configuration.php'
    
    # Repository service
    Acme\Bundle\CustomerGroupInventoryBundle\Entity\Repository\CustomerGroupInventoryRepository:
        tags:
            - { name: doctrine.repository_service }


    # Providers
    Acme\Bundle\CustomerGroupInventoryBundle\Provider\CustomerGroupInventoryProvider:
        public: true
        arguments:
            - '@doctrine'
            - '@Acme\Bundle\CustomerGroupInventoryBundle\Provider\CustomerGroupContextResolver'
            - '@oro_website.manager'
            - '@?cache.app'

    Acme\Bundle\CustomerGroupInventoryBundle\Provider\CustomerGroupContextResolver:
        arguments:
            - '@security.token_storage'
            - '@oro_customer.provider.customer_user_relations_provider'
            - '@request_stack'
            - '@oro_security.token_accessor'

    # Event subscribers
    Acme\Bundle\CustomerGroupInventoryBundle\EventSubscriber\InventoryCacheInvalidationSubscriber:
        arguments:
            - '@Acme\Bundle\CustomerGroupInventoryBundle\Provider\CustomerGroupInventoryProvider'
        tags:
            - { name: doctrine.event_subscriber }

    # Controller
    Acme\Bundle\CustomerGroupInventoryBundle\Controller\CustomerGroupInventoryController:
        autowire: false
        autoconfigure: false
        arguments:
            - '@doctrine'
            - '@oro_security.token_accessor'
            - '@Acme\Bundle\CustomerGroupInventoryBundle\Provider\CustomerGroupInventoryProvider'
        tags: ['controller.service_arguments']
        public: true
        calls:
            - [setContainer, ['@service_container']]

    # Form types
    Acme\Bundle\CustomerGroupInventoryBundle\Form\Type\CustomerGroupInventoryType:
        tags:
            - { name: form.type }

    Acme\Bundle\CustomerGroupInventoryBundle\Form\Extension\ProductTypeExtension:
        arguments:
            - '@doctrine'
        tags:
            - { name: form.type_extension, extended_type: 'Oro\Bundle\ProductBundle\Form\Type\ProductType' }

    # Layout data provider
    acme.cg_inventory.layout_data_provider:
        class: Acme\Bundle\CustomerGroupInventoryBundle\Layout\DataProvider\CustomerGroupInventoryDataProvider
        arguments:
            - '@Acme\Bundle\CustomerGroupInventoryBundle\Provider\CustomerGroupInventoryProvider'
        tags:
            - { name: layout.data_provider, alias: acme_cg_inventory }
    
    # Twig extension
    Acme\Bundle\CustomerGroupInventoryBundle\Twig\CustomerGroupInventoryExtension:
        arguments:
            - '@Acme\Bundle\CustomerGroupInventoryBundle\Provider\CustomerGroupInventoryProvider'
            - '@doctrine'
        tags:
            - { name: twig.extension }
    
    # Shopping list datagrid listener
    Acme\Bundle\CustomerGroupInventoryBundle\EventListener\ShoppingListDatagridListener:
        arguments:
            - '@Acme\Bundle\CustomerGroupInventoryBundle\Provider\CustomerGroupInventoryProvider'
            - '@doctrine'
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.before, method: onBuildBefore }
            - { name: kernel.event_listener, event: oro_datagrid.orm_datasource.result.after, method: onResultAfter }